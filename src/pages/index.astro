---
import Layout from '../layouts/Layout.astro';
import PostCard from '../components/PostCard.astro';

// Usamos Astro.glob para obtener los posts de la carpeta src/content/post
const posts = await Astro.glob('../content/posts/*.md');

// Validar los posts según el esquema definido en config.ts
const validPosts = posts.filter((post) => {
  const { frontmatter } = post;
  return frontmatter.title && frontmatter.slug && frontmatter.date && frontmatter.category && frontmatter.image && frontmatter.excerpt;
});

// Ordenar los posts por fecha (descendente)
validPosts.sort((a, b) => new Date(b.frontmatter.date).getTime() - new Date(a.frontmatter.date).getTime());

// Limitar a los 5 posts más recientes
const recentPosts = validPosts.slice(0, 5);

// Obtener las categorías únicas de los posts
const categories = [...new Set(validPosts.map(post => post.frontmatter.category))];
---

<Layout title="Tuna de Derecho de Santiago de Compostela">
  <h1 class="title">Bienvenido!</h1>
  <p class="intro">¡Aquí encontrarás los últimos posts de la Tuna de Derecho Compostelana!</p>
  
  <section class="categorias">
    <h2>Categorías:</h2>
    <ul>
      {categories.map(category => (
        <li><a href={`/category/${category.toLowerCase()}`}>{category}</a></li>
      ))}
    </ul>
  </section>
  
  <section class="recent-posts">
    {recentPosts.map(post => (
      <PostCard
        title={post.frontmatter.title}
        date={post.frontmatter.date}
        slug={post.frontmatter.slug}  
        excerpt={post.frontmatter.excerpt}
        image={post.frontmatter.image}
        category={post.frontmatter.category}
      />
    ))}
  </section>

  <div class="view-all-container">
    <a href="/posts" class="view-all-button">Ver todos los posts</a>
  </div>
</Layout>
