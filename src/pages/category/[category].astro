---
import { getCollection } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

// Obtener todos los posts de la colección 'posts'
const posts = await getCollection('posts');

// Obtener la categoría actual basándonos en la ruta
const { category } = Astro.params;

// Filtrar los posts por categoría específica
const filteredPosts = posts.filter(post => 
  post.data.category && post.data.category.toLowerCase() === category.toLowerCase()
);

// Manejo de error si no hay posts en la categoría
if (filteredPosts.length === 0) {
  throw new Error('No hay posts en esta categoría');
}
---

<Layout title={`Posts de ${category}`}>
  <h1>Posts de {category}</h1>
  <section class="category-posts">
    {filteredPosts.map(post => (
      <article>
        <h2>{post.data.title}</h2>
        <p><em>{new Date(post.data.date).toLocaleDateString()}</em></p>
        <p>{post.data.category}</p>
        <img src={post.data.image} alt={post.data.title} />
        <div set:html={post.body}></div>
      </article>
    ))}
  </section>
</Layout>

<style>
  h1 {
    font-size: 2.5rem;
    color: var(--color-primary);
    margin-bottom: 2rem;
  }

  .category-posts {
    display: grid;
    gap: 2rem;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
  }

  @media (max-width: 768px) {
    h1 {
      font-size: 2rem;
    }
  }
</style>
